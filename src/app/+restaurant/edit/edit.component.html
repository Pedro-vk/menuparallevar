<ng-container *ngIf="restaurant">
  <form #menu="ngForm" class="content padding">
    <h1 class="text text--h1">{{restaurant.name}}</h1>
    <span class="text text--small text--link padding--half-top clickable" (click)="editRestaurant = true">
      Editar información de mi restaurante
    </span>

    <div class="divider--space"></div>

    <div class="padding--top padding--bottom layout layout--sides">
      <h2 class="text text--h2 layout--ellipsis">{{restaurant.menu.name}}</h2>
      <div>
        <input
          #price
          name="price"
          [(ngModel)]="restaurant.menu.price"
          class="text text--h2 text--high price-input"
          type="number"
          required
          placeholder="##,##"
          min="0"><!--
     --><span class="text text--h2 text--high">€</span><!--
     --><span class="text text--small text--alt price-tip" (click)="price.focus()">Pulsa para editar</span>
      </div>
    </div>

    <ng-container *ngFor="let section of restaurant.menu.sections; let sIndex = index; let last = last; trackBy: trackIndex">
      <div class="padding--top padding--bottom">
        <h3 class="text text--alt">{{section.title}}</h3>

        <div
          *ngFor="let item of section.items; let index = index; trackBy: trackIndex"
          class="padding--half-top layout layout--sides">

          <input
            required
            name="dish-{{sIndex}}-{{index}}"
            [(ngModel)]="section.items[index]"
            placeholder="Nuevo plato"
            class="text">

          <span class="mat-icon clickable" (click)="section.items.splice(index, 1)">delete</span>
        </div>

        <div class="divider--space"></div>

        <button class="button button--secondary" (click)="section.items.push(undefined)">
          Añadir {{section.title | lowercase}}
        </button>
      </div>

      <div class="divider" [class.divider--space]="last"></div>
    </ng-container>

    <div class="layout layout--sides padding--half-top padding--half-bottom">
      <span>Incluye bebida</span>
      <span
        class="switch"
        [class.switch--active]="restaurant.menu.includeBeverage"
        (click)="restaurant.menu.includeBeverage = !restaurant.menu.includeBeverage">
      </span>
    </div>
    <div class="layout layout--sides padding--half-top padding--half-bottom">
      <span>Incluye pan</span>
      <span
        class="switch"
        [class.switch--active]="restaurant.menu.includeBread"
        (click)="restaurant.menu.includeBread = !restaurant.menu.includeBread">
      </span>
    </div>

    <div class="divider--space-and-half"></div>
  </form>

  <div class="footer-message text text--alt text--center padding">
    Hecho con ❤️ en tiempos de Covid-19
  </div>

  <div class="footer text--right layout layout--buttons">
    <button class="button" [disabled]="!published" (click)="share()">
      Compartir
    </button>
    <button class="button" [disabled]="menu.invalid || !restaurant.menu.price" (click)="save()">
      {{published ? 'Guardar' : 'Publicar'}}
    </button>
  </div>
</ng-container>

<div class="overlay" [class.overlay--visible]="editRestaurant" *ngIf="restaurant">

  <span class="mat-icon mat-icon--dark overlay-close clickable" *ngIf="exists" (click)="editRestaurant = false">
    close
  </span>

  <form #info="ngForm" class="overlay-content">
    <div class="text text--h2 text--center">Mi restaurante</div>

    <div class="divider--double"></div>

    <div class="padding--top">
      <div class="text text--small text--alt">Nombre</div>
      <input
        name="name"
        required
        [(ngModel)]="restaurant.name"
        class="text input">
    </div>

    <div class="divider--half-space"></div>

    <div class="padding--top">
      <div class="text text--small text--alt">Número de teléfono</div>
      <input
        type="tel"
        required
        pattern="[\d -]+"
        name="phone"
        [(ngModel)]="restaurant.phone"
        class="text input">

      <div class="text text--small text--alt text--center padding--half-top">
        Usaremos el teléfono para que los clientes te puedan llamar directamente
      </div>
    </div>
  </form>

  <div class="footer">
    <button
      class="button button--full"
      [disabled]="info.invalid || !restaurant.name"
      (click)="save(true); editRestaurant = false">

      Guardar
    </button>
  </div>
</div>
